<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:fb="https://www.facebook.com/2008/fbml" itemscope="itemscope" itemtype="http://schema.org/Product">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="readme-deploy" content="0a76ad4a2ae68a6f7b480e04f93f1d2d4fab9046">
    <title>Phoenix</title>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <meta name="description" content="Productive. Reliable. Fast. A productive web framework that does not compromise speed and maintainability">
    <link href="/favicon.ico" rel="shortcut icon" type="image/x-icon">
    <meta property="og:title" content="Phoenix">
    <meta property="og:description" content="Productive. Reliable. Fast. A productive web framework that does not compromise speed and maintainability">
    <meta property="og:image" content="https://files.readme.io/PKPqx8L9TJSAY2Bnmw7F_phoenixframework-logo-white@2x.png">
    <meta property="og:site_name" content="Phoenix">
    <meta id="config-proxy-url" content="https://proxy.readme.io/proxy">
    <link rel="canonical" href="http://www.phoenixframework.org/www.phoenixframework.org">
    <link rel="alternate" type="application/rss+xml" title="RSS Feed for Phoenix" href="/blog.rss">
    <link rel="stylesheet" href="/assets/css/base.css" />
    <script type="text/javascript" src="/assets/js/app.js"></script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-57337100-1', 'auto');
      ga('send', 'pageview');
    </script>
    <link href="//fonts.googleapis.com/css?family=Open+Sans:400:sans-serif|Open+Sans:400:sans-serif" rel="stylesheet" type="text/css">
  </head>

  <body class="layout page-home body-none theme-solid header-solid header-bg-size-auto header-bg-pos-tl header-overlay-triangles lumosity-light undefined theme-threes ng-scope os-linux" cz-shortcut-listen="true">
<div class="wrapper">
  <header id="header" class="header">
    <div class="container">
      <h1 class="navbar-brand"><a href="/">Phoenix</a></h1>
      <div class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          <li><a href="https://hexdocs.pm/phoenix/overview.html">Guides</a></li>
          <li><a href="https://hexdocs.pm/phoenix/Phoenix.html">Docs</a></li>
          <li><a href="/community">Community</a></li>
          <li><a href="https://github.com/phoenixframework/phoenix">GitHub</a></li>
          <li><a href="/blog" title="Blog">Blog</a></li>
        </ul>

        <ul class="nav navbar-nav pull-right">
          <li><a class="phx-book" href="https://pragprog.com/book/phoenix/programming-phoenix" title="Book">ðŸ“™ &nbsp;&nbsp; Book</a></li>
        </ul>
      </div>
    </div>
    </header>
    <br/>
<div class="container body-container">
  <div class="row">
    <div class="col-sm-3 border-right">
        <div class="sidebar-nav">
          <h4>News</h4>
          <ul>
            <li><a href="/blog/phoenix-1-3-0-released" class="active"><span>Phoenix 1.3.0 Released</span></a></li>
            <li><a href="/blog/contribution-sprint" class="active"><span>Contribution Sprint</span></a></li>
            <li><a href="/blog/upgrading-from-120-to-130" class="active"><span>Upgrading from 1.2.x to 1.3.0</span></a></li>
            <li><a href="/blog/upgrading-from-11x-to-120" class="active"><span>Upgrading from 1.1.x to 1.2.0</span></a></li>
            <li><a href="/blog/upgrading-from-111-to-112" class="active"><span>Upgrading from 1.1.1 to 1.1.2</span></a></li>
            <li><a href="/blog/upgrading-from-v10-to-v11" class="active"><span>Upgrading from v1.0 to v1.1</span></a></li>
            <li><a href="/blog/the-road-to-2-million-websocket-connections" class="active"><span>The Road to 2 Million Websocket Connections in Phoenix</span></a></li>
            <li><a href="/blog/phoenix-10-the-framework-for-the-modern-web-just-landed"><span>Phoenix 1.0 â€“ the framework for the modern web just landed</span></a></li>
            <li><a href="/blog/phoenix-0100-released-with-assets-handling-generat"><span>Phoenix 0.10.0 released with assets handling, generators, &amp; more</span></a></li>
          </ul>
        </div>
    </div>
    <div class="col-sm-9 border-left">
      <div class="docs-content">
        <div class="docs-header">
          <h1>Upgrading from v1.0 to v1.1</h1>
          
            <div class="byline">
                <span>By Lance Halverson</span>
                &nbsp;Â·&nbsp;<span class="ago">2015-12-27</span>
                &nbsp;Â·&nbsp;<span>v1.0.0</span>
            </div>
          
          <hr>
        </div>
        <div class="content block-content ready">
          <h1>Phoenix 1.0.x to 1.1.0 upgrade instructions</h1>
<p>Please use the gist if you have issues <a href="https://gist.github.com/chrismccord/557ef22e2a03a7992624">https://gist.github.com/chrismccord/557ef22e2a03a7992624</a></p>
<h2>Deps</h2>
<p>Update your <code class="inline">phoenix</code>, <code class="inline">phoenix_html</code> deps, and if using ecto, update your <code class="inline">phoenix_ecto</code> dep</p>
<pre><code class="elixir"># mix.exs
def deps do
  [{:phoenix, &quot;~&gt; 1.1&quot;},
   {:phoenix_ecto, &quot;~&gt; 2.0&quot;},
   {:phoenix_html, &quot;~&gt; 2.3&quot;},
   ...]
end</code></pre>
<p>Now run <code class="inline">$ mix deps.update phoenix phoenix_html phoenix_ecto</code></p>
<h2>View / Template Changes</h2>
<p>The <code class="inline">@inner</code> assign has been removed in favor of explicit rendering with <code class="inline">render/3</code> and the new <code class="inline">@view_module</code> and <code class="inline">view_template</code> assigns.</p>
<p>In your <code class="inline">web/templates/layout/app.html.eex</code> (and other layouts), replace:</p>
<pre><code>&lt;%= @inner %&gt;</code></pre>
<p>with:</p>
<pre><code>&lt;%= render @view_module, @view_template, assigns %&gt;</code></pre>
<h2>Ecto Changes</h2>
<p>Ecto 1.1 has renamed <code class="inline">Ecto.Model</code> to <code class="inline">Ecto.Schema</code> and moved many Model functions to the <code class="inline">Ecto</code> module. Update your <code class="inline">web/web.ex</code> blocks:</p>
<pre><code class="diff">def model do
  quote
-   use Ecto.Model
+   use Ecto.Schema

+   import Ecto
    import Ecto.Changeset
    ...  
  end 
end

def controller do
  quote
    ...
    alias MyApp.Repo
+   import Ecto
    import Ecto.Query, only: [from: 1, from: 2]
    ...  
  end 
end

def channel do
  quote
    ...
    alias MyApp.Repo
+   import Ecto
    import Ecto.Query, only: [from: 1, from: 2]
    ...  
  end 
end</code></pre>
<h2>Gettext (optional)</h2>
<p>Gettext has been added for internationalization and localization support.
See the <a href="http://hexdocs.pm/gettext/Gettext.html">Gettext docs</a> for full details.</p>
<p>To add Gettext support to your application first add <code class="inline">:gettext</code> to your deps in <code class="inline">mix.exs</code>:</p>
<pre><code class="elixir">def deps do
  [...,
   {:gettext, &quot;~&gt; 0.9&quot;},
   ...]
end</code></pre>
<p>Next, in <code class="inline">mix.exs</code>, add the <code class="inline">:gettext</code> compiler to your <code class="inline">project</code> and <code class="inline">:gettext</code> to your <code class="inline">:applications</code> list in <code class="inline">application</code> list:</p>
<pre><code class="diff">def project do
  [...,
-  compilers: [:phoenix] ++ Mix.compilers,
+  compilers: [:phoenix, :gettext] ++ Mix.compilers,
  ...]
end

def application do
  [mod: {MyApp, []},
-  applications: [:phoenix, :phoenix_html, :cowboy, :logger,
-                 :phoenix_ecto, :postgrex]]
+  applications: [:phoenix, :phoenix_html, :cowboy, :logger, :gettext,
+                 :phoenix_ecto, :postgrex]]
end</code></pre>
<p>Next, run <code class="inline">$ mix deps.get</code></p>
<p>Now, create a <code class="inline">gettext.ex</code> file at <code class="inline">web/gettext.ex</code> with the following contents:</p>
<pre><code class="elixir">defmodule MyApp.Gettext do
  @moduledoc &quot;&quot;&quot;
  A module providing Internationalization with a gettext-based API.

  By using [Gettext](http://hexdocs.pm/gettext),
  your module gains a set of macros for translations, for example:

      import MyApp.Gettext

      # Simple translation
      gettext &quot;Here is the string to translate&quot;

      # Plural translation
      ngettext &quot;Here is the string to translate&quot;,
               &quot;Here are the strings to translate&quot;,
               3

      # Domain-based translation
      dgettext &quot;errors&quot;, &quot;Here is the error message to translate&quot;

  See the [Gettext Docs](http://hexdocs.pm/gettext) for detailed usage.
  &quot;&quot;&quot;
  use Gettext, otp_app: :my_app
end</code></pre>
<p>Replace <code class="inline">MyApp</code> with your app module and <code class="inline">:my_app</code> with your otp app.</p>
<p>Next run the following commands from your app root to add necessary gettext supporting files:</p>
<pre><code class="console">$ mkdir -p priv/gettext/en/LC_MESSAGES
$ curl https://raw.githubusercontent.com/phoenixframework/phoenix/277eb7dd03366b336458ffe8dbf637c133b595f0/installer/templates/new/priv/gettext/en/LC_MESSAGES/errors.po &gt; priv/gettext/en/LC_MESSAGES/errors.po
$ curl https://raw.githubusercontent.com/phoenixframework/phoenix/277eb7dd03366b336458ffe8dbf637c133b595f0/installer/templates/new/priv/gettext/errors.pot &gt; priv/gettext/errors.pot</code></pre>
<p>Next, create a <code class="inline">web/views/error_helpers.ex</code> and add these contents:</p>
<pre><code class="elixir">defmodule MyApp.ErrorHelpers do
  @moduledoc &quot;&quot;&quot;
  Conveniences for translating and building error messages.
  &quot;&quot;&quot;
  use Phoenix.HTML

  @doc &quot;&quot;&quot;
  Generates tag for inlined form input errors.
  &quot;&quot;&quot;
  def error_tag(form, field) do
    if error = form.errors[field] do
      content_tag :span, translate_error(error), class: &quot;help-block&quot;
    end
  end

  @doc &quot;&quot;&quot;
  Translates an error message using gettext.
  &quot;&quot;&quot;
  def translate_error({msg, opts}) do
    # Because error messages were defined within Ecto, we must
    # call the Gettext module passing our Gettext backend. We
    # also use the &quot;errors&quot; domain as translations are placed
    # in the errors.po file. On your own code and templates,
    # this could be written simply as:
    #
    #     dngettext &quot;errors&quot;, &quot;1 file&quot;, &quot;%{count} files&quot;, count
    #
    Gettext.dngettext(MyApp.Gettext, &quot;errors&quot;, msg, msg, opts[:count], opts)
  end

  def translate_error(msg) do
    Gettext.dgettext(MyApp.Gettext, &quot;errors&quot;, msg)
  end
end</code></pre>
<p>And now you can import <code class="inline">Gettext</code> and <code class="inline">MyApp.ErrorHelpers</code> into your <code class="inline">web.ex</code> <code class="inline">view</code> block:</p>
<pre><code class="diff">import MyApp.Router.Helpers
+     import MyApp.ErrorHelpers
+     import MyApp.Gettext</code></pre>
<h2>ChangesetView changes</h2>
<p>Changests are no longer encoded to errors when encoding to JSON. The changeset errors should be rendered explicitly. Update your <code class="inline">web/views/changeset_view.ex</code> (if it exists) with the following code:</p>
<pre><code class="elixir">defmodule MyApp.ChangesetView do
  use MyApp.Web, :view

  @doc &quot;&quot;&quot;
  Traverses and translates changeset errors.

  See `Ecto.Changeset.traverse_errors/2` and
  `MyApp.ErrorHelpers.translate_error/1` for more details.
  &quot;&quot;&quot;
  def translate_errors(changeset) do
    Ecto.Changeset.traverse_errors(changeset, &amp;translate_error/1)
  end

  def render(&quot;error.json&quot;, %{changeset: changeset}) do
    # When encoded, the changeset returns its errors
    # as a JSON object. So we just pass it forward.
    %{errors: translate_errors(changeset)}
  end
end</code></pre>
<p>If you are not using Gettext with the <code class="inline">ErrorHelpers</code> module, add this function to your <code class="inline">ChangesetView</code>:</p>
<pre><code class="elixir">def translate_error({msg, opts}) do
  String.replace(msg, &quot;%{count}&quot;, to_string(opts[:count]))
end
def translate_error(msg), do: msg</code></pre>
<h2>Channels JavaScript Client changes</h2>
<p><code class="inline">after</code> hooks have been replaced by a timeout option on <code class="inline">push</code>, and a <code class="inline">receive(&quot;timeout&quot;, callback)</code> hook.</p>
<pre><code class="javascript">// 1.0.x
channel.push(&quot;new_message&quot;, {body: &quot;hi!&quot;})
       .receive(&quot;ok&quot;, resp =&gt; console.log(resp) )
       .after(5000, () =&gt; console.log(&quot;times! up&quot;))

channel.push(&quot;new_message&quot;, {body: &quot;hi!&quot;})
       .receive(&quot;ok&quot;, resp =&gt; console.log(resp) )
       .after(12000, () =&gt; console.log(&quot;times! up&quot;))

// 1.1.0
// timeout default to 5000
channel.push(&quot;new_message&quot;, {body: &quot;hi!&quot;}) 
       .receive(&quot;ok&quot;, resp =&gt; console.log(resp) )
       .receive(&quot;timeout&quot;, () =&gt; console.log(&quot;times! up&quot;))

// custom timeout as optional 3rd arg
channel.push(&quot;new_message&quot;, {body: &quot;hi!&quot;}, 12000)
       .receive(&quot;ok&quot;, resp =&gt; console.log(resp) )
       .receive(&quot;timeout&quot;, () =&gt; console.log(&quot;times! up&quot;))</code></pre>

        </div>
      </div>
    </div>
  </div>
</div>

  </div>
  </body>
</html>
